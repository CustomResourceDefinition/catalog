{
  "description": "OSImageStream describes a set of streams and associated images available\nfor the MachineConfigPools to be used as base OS images.\n\nThe resource is a singleton named \"cluster\".\n\nCompatibility level 4: No compatibility is provided, the API can change at any point for any reason. These capabilities should not be used by applications needing long term support.",
  "type": "object",
  "required": [
    "spec"
  ],
  "properties": {
    "apiVersion": {
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources",
      "type": "string"
    },
    "kind": {
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds",
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "description": "spec contains the desired OSImageStream config configuration.",
      "type": "object",
      "properties": {
        "defaultStream": {
          "description": "defaultStream is the desired name of the stream that should be used as the\ndefault when no specific stream is requested by a MachineConfigPool.\n\nThis field is set by the installer during installation. Users may need to\nupdate it if the currently selected stream is no longer available, for\nexample when the stream has reached its End of Life.\nThe MachineConfigOperator uses this value to determine which stream from\nstatus.availableStreams to apply as the default for MachineConfigPools\nthat do not specify a stream override.\n\nIt must be a valid RFC 1123 subdomain between 1 and 253 characters in length,\nconsisting of lowercase alphanumeric characters, hyphens ('-'), and periods ('.').",
          "type": "string",
          "maxLength": 253,
          "minLength": 1,
          "x-kubernetes-validations": [
            {
              "rule": "!format.dns1123Subdomain().validate(self).hasValue()",
              "message": "a RFC 1123 subdomain must consist of lower case alphanumeric characters, '-' or '.', and must start and end with an alphanumeric character."
            }
          ]
        }
      },
      "additionalProperties": false
    },
    "status": {
      "description": "status describes the last observed state of this OSImageStream.\nPopulated by the MachineConfigOperator after reading release metadata.\nWhen not present, the controller has not yet reconciled this resource.",
      "type": "object",
      "required": [
        "availableStreams",
        "defaultStream"
      ],
      "properties": {
        "availableStreams": {
          "description": "availableStreams is a list of the available OS Image Streams that can be\nused as the base image for MachineConfigPools.\navailableStreams is required, must have at least one item, must not exceed\n100 items, and must have unique entries keyed on the name field.",
          "type": "array",
          "maxItems": 100,
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "name",
              "osExtensionsImage",
              "osImage"
            ],
            "properties": {
              "name": {
                "description": "name is the required identifier of the stream.\n\nname is determined by the operator based on the OCI label of the\ndiscovered OS or Extension Image.\n\nMust be a valid RFC 1123 subdomain between 1 and 253 characters in length,\nconsisting of lowercase alphanumeric characters, hyphens ('-'), and periods ('.').",
                "type": "string",
                "maxLength": 253,
                "minLength": 1,
                "x-kubernetes-validations": [
                  {
                    "rule": "!format.dns1123Subdomain().validate(self).hasValue()",
                    "message": "a RFC 1123 subdomain must consist of lower case alphanumeric characters, '-' or '.', and must start and end with an alphanumeric character."
                  }
                ]
              },
              "osExtensionsImage": {
                "description": "osExtensionsImage is a required OS Extensions Image referenced by digest.\n\nosExtensionsImage bundles the extra repositories used to enable extensions, augmenting\nthe base operating system without modifying the underlying immutable osImage.\n\nThe format of the image pull spec is: host[:port][/namespace]/name@sha256:\u003cdigest\u003e,\nwhere the digest must be 64 characters long, and consist only of lowercase hexadecimal characters, a-f and 0-9.\nThe length of the whole spec must be between 1 to 447 characters.",
                "type": "string",
                "maxLength": 447,
                "minLength": 1,
                "x-kubernetes-validations": [
                  {
                    "rule": "(self.split('@').size() == 2 \u0026\u0026 self.split('@')[1].matches('^sha256:[a-f0-9]{64}$'))",
                    "message": "the OCI Image reference must end with a valid '@sha256:\u003cdigest\u003e' suffix, where '\u003cdigest\u003e' is 64 characters long"
                  },
                  {
                    "rule": "(self.split('@')[0].matches('^([a-zA-Z0-9-]+\\\\.)+[a-zA-Z0-9-]+(:[0-9]{2,5})?/([a-zA-Z0-9-_]{0,61}/)?[a-zA-Z0-9-_.]*?$'))",
                    "message": "the OCI Image name should follow the host[:port][/namespace]/name format, resembling a valid URL without the scheme"
                  }
                ]
              },
              "osImage": {
                "description": "osImage is a required OS Image referenced by digest.\n\nosImage contains the immutable, fundamental operating system components, including the kernel\nand base utilities, that define the core environment for the node's host operating system.\n\nThe format of the image pull spec is: host[:port][/namespace]/name@sha256:\u003cdigest\u003e,\nwhere the digest must be 64 characters long, and consist only of lowercase hexadecimal characters, a-f and 0-9.\nThe length of the whole spec must be between 1 to 447 characters.",
                "type": "string",
                "maxLength": 447,
                "minLength": 1,
                "x-kubernetes-validations": [
                  {
                    "rule": "(self.split('@').size() == 2 \u0026\u0026 self.split('@')[1].matches('^sha256:[a-f0-9]{64}$'))",
                    "message": "the OCI Image reference must end with a valid '@sha256:\u003cdigest\u003e' suffix, where '\u003cdigest\u003e' is 64 characters long"
                  },
                  {
                    "rule": "(self.split('@')[0].matches('^([a-zA-Z0-9-]+\\\\.)+[a-zA-Z0-9-]+(:[0-9]{2,5})?/([a-zA-Z0-9-_]{0,61}/)?[a-zA-Z0-9-_.]*?$'))",
                    "message": "the OCI Image name should follow the host[:port][/namespace]/name format, resembling a valid URL without the scheme"
                  }
                ]
              }
            },
            "additionalProperties": false
          },
          "x-kubernetes-list-map-keys": [
            "name"
          ],
          "x-kubernetes-list-type": "map"
        },
        "defaultStream": {
          "description": "defaultStream is the name of the stream that should be used as the default\nwhen no specific stream is requested by a MachineConfigPool.\n\nIt must be a valid RFC 1123 subdomain between 1 and 253 characters in length,\nconsisting of lowercase alphanumeric characters, hyphens ('-'), and periods ('.'),\nand must reference the name of one of the streams in availableStreams.",
          "type": "string",
          "maxLength": 253,
          "minLength": 1,
          "x-kubernetes-validations": [
            {
              "rule": "!format.dns1123Subdomain().validate(self).hasValue()",
              "message": "a RFC 1123 subdomain must consist of lower case alphanumeric characters, '-' or '.', and must start and end with an alphanumeric character."
            }
          ]
        }
      },
      "additionalProperties": false,
      "x-kubernetes-validations": [
        {
          "rule": "self.defaultStream in self.availableStreams.map(s, s.name)",
          "message": "defaultStream must reference a stream name from availableStreams"
        }
      ]
    }
  },
  "x-kubernetes-validations": [
    {
      "rule": "self.metadata.name == 'cluster'",
      "message": "osimagestream is a singleton, .metadata.name must be 'cluster'"
    }
  ]
}
