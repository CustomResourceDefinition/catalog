{
  "type": "object",
  "properties": {
    "apiVersion": {
      "type": "string"
    },
    "kind": {
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "type": "object",
      "required": [
        "prefix",
        "service"
      ],
      "properties": {
        "add_linkerd_headers": {
          "type": "boolean"
        },
        "add_request_headers": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "append": {
                "type": "boolean"
              },
              "v2Representation": {
                "type": "string",
                "enum": [
                  "",
                  "string",
                  "null"
                ]
              },
              "value": {
                "type": "string"
              }
            }
          }
        },
        "add_response_headers": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "append": {
                "type": "boolean"
              },
              "v2Representation": {
                "type": "string",
                "enum": [
                  "",
                  "string",
                  "null"
                ]
              },
              "value": {
                "type": "string"
              }
            }
          }
        },
        "allow_upgrade": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ambassador_id": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "auth_context_extensions": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "auto_host_rewrite": {
          "type": "boolean"
        },
        "bypass_auth": {
          "type": "boolean"
        },
        "bypass_error_response_overrides": {
          "type": "boolean"
        },
        "case_sensitive": {
          "type": "boolean"
        },
        "circuit_breakers": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "max_connections": {
                "type": "integer"
              },
              "max_pending_requests": {
                "type": "integer"
              },
              "max_requests": {
                "type": "integer"
              },
              "max_retries": {
                "type": "integer"
              },
              "priority": {
                "type": "string",
                "enum": [
                  "default",
                  "high"
                ]
              }
            },
            "additionalProperties": false
          }
        },
        "cluster_idle_timeout_ms": {
          "type": "integer"
        },
        "cluster_max_connection_lifetime_ms": {
          "type": "integer"
        },
        "cluster_tag": {
          "type": "string"
        },
        "connect_timeout_ms": {
          "type": "integer"
        },
        "cors": {
          "type": "object",
          "properties": {
            "credentials": {
              "type": "boolean"
            },
            "exposed_headers": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "headers": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "max_age": {
              "type": "string"
            },
            "methods": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "origins": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "v2CommaSeparatedOrigins": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        },
        "dns_type": {
          "type": "string"
        },
        "docs": {
          "type": "object",
          "properties": {
            "display_name": {
              "type": "string"
            },
            "ignored": {
              "type": "boolean"
            },
            "path": {
              "type": "string"
            },
            "timeout_ms": {
              "type": "integer"
            },
            "url": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "enable_ipv4": {
          "type": "boolean"
        },
        "enable_ipv6": {
          "type": "boolean"
        },
        "envoy_override": {
          "type": "object",
          "x-kubernetes-preserve-unknown-fields": true
        },
        "error_response_overrides": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "body",
              "on_status_code"
            ],
            "properties": {
              "body": {
                "type": "object",
                "properties": {
                  "content_type": {
                    "type": "string"
                  },
                  "json_format": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "string"
                    }
                  },
                  "text_format": {
                    "type": "string"
                  },
                  "text_format_source": {
                    "type": "object",
                    "properties": {
                      "filename": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "on_status_code": {
                "type": "integer",
                "maximum": 599,
                "minimum": 400
              }
            },
            "additionalProperties": false
          }
        },
        "grpc": {
          "type": "boolean"
        },
        "headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "health_checks": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "health_check"
            ],
            "properties": {
              "health_check": {
                "type": "object",
                "maxProperties": 1,
                "minProperties": 1,
                "properties": {
                  "grpc": {
                    "type": "object",
                    "required": [
                      "upstream_name"
                    ],
                    "properties": {
                      "authority": {
                        "type": "string"
                      },
                      "upstream_name": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  },
                  "http": {
                    "type": "object",
                    "required": [
                      "path"
                    ],
                    "properties": {
                      "add_request_headers": {
                        "type": "object",
                        "additionalProperties": {
                          "type": "object",
                          "properties": {
                            "append": {
                              "type": "boolean"
                            },
                            "v2Representation": {
                              "type": "string",
                              "enum": [
                                "",
                                "string",
                                "null"
                              ]
                            },
                            "value": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "expected_statuses": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "required": [
                            "max",
                            "min"
                          ],
                          "properties": {
                            "max": {
                              "type": "integer",
                              "maximum": 599,
                              "minimum": 100
                            },
                            "min": {
                              "type": "integer",
                              "maximum": 599,
                              "minimum": 100
                            }
                          },
                          "additionalProperties": false
                        }
                      },
                      "hostname": {
                        "type": "string"
                      },
                      "path": {
                        "type": "string"
                      },
                      "remove_request_headers": {
                        "type": "array",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "healthy_threshold": {
                "type": "integer"
              },
              "interval": {
                "type": "string"
              },
              "timeout": {
                "type": "string"
              },
              "unhealthy_threshold": {
                "type": "integer"
              }
            },
            "additionalProperties": false
          }
        },
        "host": {
          "type": "string"
        },
        "host_redirect": {
          "type": "boolean"
        },
        "host_regex": {
          "type": "boolean"
        },
        "host_rewrite": {
          "type": "string"
        },
        "hostname": {
          "type": "string"
        },
        "idle_timeout_ms": {
          "type": "integer"
        },
        "keepalive": {
          "type": "object",
          "properties": {
            "idle_time": {
              "type": "integer"
            },
            "interval": {
              "type": "integer"
            },
            "probes": {
              "type": "integer"
            }
          },
          "additionalProperties": false
        },
        "labels": {
          "type": "object",
          "additionalProperties": {
            "description": "A MappingLabelGroupsArray is an array of MappingLabelGroups. I know, complex.",
            "type": "array",
            "items": {
              "description": "A MappingLabelGroup is a single element of a MappingLabelGroupsArray: a second map, where the key is a human-readable name that identifies the group.",
              "type": "object",
              "maxProperties": 1,
              "minProperties": 1,
              "additionalProperties": {
                "description": "A MappingLabelsArray is the value in the MappingLabelGroup: an array of label specifiers.",
                "type": "array",
                "items": {
                  "description": "A MappingLabelSpecifier (finally!) defines a single label. \n This mimics envoy/config/route/v3/route_components.proto:RateLimit:Action:action_specifier.",
                  "type": "object",
                  "maxProperties": 1,
                  "minProperties": 1,
                  "properties": {
                    "destination_cluster": {
                      "description": "Sets the label \"destination_cluster=«Envoy destination cluster name»\".",
                      "type": "object",
                      "required": [
                        "key"
                      ],
                      "properties": {
                        "key": {
                          "type": "string",
                          "enum": [
                            "destination_cluster"
                          ]
                        }
                      }
                    },
                    "generic_key": {
                      "description": "Sets the label \"«key»=«value»\" (where by default «key» is \"generic_key\").",
                      "type": "object",
                      "required": [
                        "value"
                      ],
                      "properties": {
                        "key": {
                          "description": "The default is \"generic_key\".",
                          "type": "string"
                        },
                        "v2Shorthand": {
                          "type": "boolean"
                        },
                        "value": {
                          "type": "string"
                        }
                      }
                    },
                    "remote_address": {
                      "description": "Sets the label \"remote_address=«IP address of the client»\".",
                      "type": "object",
                      "required": [
                        "key"
                      ],
                      "properties": {
                        "key": {
                          "type": "string",
                          "enum": [
                            "remote_address"
                          ]
                        }
                      }
                    },
                    "request_headers": {
                      "description": "If the «header_name» header is set, then set the label \"«key»=«Value of the «header_name» header»\"; otherwise skip applying this label group.",
                      "type": "object",
                      "required": [
                        "header_name",
                        "key"
                      ],
                      "properties": {
                        "header_name": {
                          "type": "string"
                        },
                        "key": {
                          "type": "string"
                        },
                        "omit_if_not_present": {
                          "type": "boolean"
                        }
                      }
                    },
                    "source_cluster": {
                      "description": "Sets the label \"source_cluster=«Envoy source cluster name»\".",
                      "type": "object",
                      "required": [
                        "key"
                      ],
                      "properties": {
                        "key": {
                          "type": "string",
                          "enum": [
                            "source_cluster"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "load_balancer": {
          "type": "object",
          "required": [
            "policy"
          ],
          "properties": {
            "cookie": {
              "type": "object",
              "required": [
                "name"
              ],
              "properties": {
                "name": {
                  "type": "string"
                },
                "path": {
                  "type": "string"
                },
                "ttl": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "header": {
              "type": "string"
            },
            "policy": {
              "type": "string",
              "enum": [
                "round_robin",
                "ring_hash",
                "maglev",
                "least_request"
              ]
            },
            "source_ip": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        },
        "method": {
          "type": "string"
        },
        "method_regex": {
          "type": "boolean"
        },
        "modules": {
          "type": "array",
          "items": {
            "type": "object",
            "x-kubernetes-preserve-unknown-fields": true
          }
        },
        "outlier_detection": {
          "type": "string"
        },
        "path_redirect": {
          "type": "string"
        },
        "precedence": {
          "type": "integer"
        },
        "prefix": {
          "type": "string"
        },
        "prefix_exact": {
          "type": "boolean"
        },
        "prefix_redirect": {
          "type": "string"
        },
        "prefix_regex": {
          "type": "boolean"
        },
        "priority": {
          "type": "string"
        },
        "query_parameters": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "redirect_response_code": {
          "type": "integer",
          "enum": [
            301,
            302,
            303,
            307,
            308
          ]
        },
        "regex_headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "regex_query_parameters": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "regex_redirect": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string"
            },
            "substitution": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "regex_rewrite": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string"
            },
            "substitution": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "remove_request_headers": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "remove_response_headers": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "resolver": {
          "type": "string"
        },
        "respect_dns_ttl": {
          "type": "boolean"
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "num_retries": {
              "type": "integer"
            },
            "per_try_timeout": {
              "type": "string"
            },
            "retry_on": {
              "type": "string",
              "enum": [
                "5xx",
                "gateway-error",
                "connect-failure",
                "retriable-4xx",
                "refused-stream",
                "retriable-status-codes"
              ]
            }
          },
          "additionalProperties": false
        },
        "rewrite": {
          "type": "string"
        },
        "service": {
          "type": "string"
        },
        "shadow": {
          "type": "boolean"
        },
        "stats_name": {
          "type": "string"
        },
        "timeout_ms": {
          "type": "integer"
        },
        "tls": {
          "type": "string"
        },
        "use_websocket": {
          "type": "boolean"
        },
        "v2BoolHeaders": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "v2BoolQueryParameters": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "v2ExplicitTLS": {
          "type": "object",
          "properties": {
            "serviceScheme": {
              "type": "string",
              "pattern": "^([hH][tT][tT][pP][sS]?://)?$"
            },
            "tls": {
              "type": "string",
              "enum": [
                "",
                "null",
                "bool:true",
                "bool:false",
                "string"
              ]
            }
          },
          "additionalProperties": false
        },
        "weight": {
          "type": "integer"
        }
      },
      "additionalProperties": false
    },
    "status": {
      "type": "object",
      "properties": {
        "reason": {
          "type": "string"
        },
        "state": {
          "type": "string",
          "enum": [
            "",
            "Inactive",
            "Running"
          ]
        }
      },
      "additionalProperties": false
    }
  }
}
