{
  "description": "CompatibilityRequirement expresses a set of requirements on a target CRD.\nIt is used to ensure compatibility between different actors using the same\nCRD.\n\nCompatibility level 4: No compatibility is provided, the API can change at any point for any reason. These capabilities should not be used by applications needing long term support.",
  "type": "object",
  "required": [
    "metadata",
    "spec"
  ],
  "properties": {
    "apiVersion": {
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources",
      "type": "string"
    },
    "kind": {
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds",
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "description": "spec is the specification of the desired behavior of the Compatibility Requirement.",
      "type": "object",
      "required": [
        "compatibilitySchema"
      ],
      "properties": {
        "compatibilitySchema": {
          "description": "compatibilitySchema defines the schema used by\ncustomResourceDefinitionSchemaValidation and objectSchemaValidation.\nThis field is required.",
          "type": "object",
          "required": [
            "customResourceDefinition",
            "requiredVersions"
          ],
          "properties": {
            "customResourceDefinition": {
              "description": "customResourceDefinition contains the complete definition of the CRD for schema and object validation purposes.\nThis field is required.",
              "type": "object",
              "required": [
                "data",
                "type"
              ],
              "properties": {
                "data": {
                  "description": "data contains the complete definition of the CRD. This field must be in\nthe format specified by the type field. It may not be longer than 1572864\ncharacters.\nThis field is required.",
                  "type": "string",
                  "maxLength": 1572864,
                  "minLength": 1
                },
                "type": {
                  "description": "type indicates the type of the CRD data. The only supported type is \"YAML\".\nThis field is required.",
                  "type": "string",
                  "enum": [
                    "YAML"
                  ]
                }
              },
              "additionalProperties": false
            },
            "excludedFields": {
              "description": "excludedFields is a set of fields in the schema which will not be validated by\ncrdSchemaValidation or objectSchemaValidation.\nThe list may contain at most 64 fields.\nWhen not specified, all fields in the schema will be validated.",
              "type": "array",
              "maxItems": 64,
              "minItems": 1,
              "items": {
                "description": "APIExcludedField describes a field in the schema which will not be validated by\ncrdSchemaValidation or objectSchemaValidation.",
                "type": "object",
                "required": [
                  "path"
                ],
                "properties": {
                  "path": {
                    "description": "path is the path to the field in the schema.\nPaths are dot-separated field names (e.g., \"fieldA.fieldB.fieldC\") representing nested object fields.\nIf part of the path is a slice (e.g., \"status.conditions\") the remaining path is applied to all items in the slice\n(e.g., \"status.conditions.lastTransitionTimestamp\").\nEach field name must be a valid Kubernetes CRD field name: start with a letter, contain only\nletters, digits, and underscores, and be between 1 and 63 characters in length.\nA path may contain at most 16 fields.",
                    "type": "string",
                    "maxLength": 1023,
                    "minLength": 1,
                    "x-kubernetes-validations": [
                      {
                        "rule": "self.split('.').size() \u003c= 16",
                        "message": "There may be at most 16 fields in the path."
                      },
                      {
                        "rule": "self.split('.', 16).all(f, f.matches('^[a-zA-Z][a-zA-Z0-9_]{0,62}$'))",
                        "message": "path must be dot-separated field names, each starting with a letter and containing only letters, digits, and underscores not exceeding 63 characters. There may be at most 16 fields in the path."
                      }
                    ]
                  },
                  "versions": {
                    "description": "versions are the API versions the field is excluded from.\nWhen not specified, the field is excluded from all versions.\n\nEach item must be at most 63 characters in length, and must must\nconsist of only lowercase alphanumeric characters and hyphens, and must\nstart with an alphabetic character and end with an alphanumeric\ncharacter.\nAt most 32 versions may be specified.",
                    "type": "array",
                    "maxItems": 32,
                    "minItems": 1,
                    "items": {
                      "description": "APIVersionString is a string representing a kubernetes API version.",
                      "type": "string",
                      "maxLength": 63,
                      "minLength": 1,
                      "x-kubernetes-validations": [
                        {
                          "rule": "!format.dns1035Label().validate(self).hasValue()",
                          "message": "It must contain only lower-case alphanumeric characters and hyphens and must start with an alphabetic character and end with an alphanumeric character"
                        }
                      ]
                    },
                    "x-kubernetes-list-type": "set"
                  }
                },
                "additionalProperties": false
              },
              "x-kubernetes-list-type": "atomic"
            },
            "requiredVersions": {
              "description": "requiredVersions specifies a subset of the CRD's API versions which will be asserted for compatibility.\nThis field is required.",
              "type": "object",
              "required": [
                "defaultSelection"
              ],
              "properties": {
                "additionalVersions": {
                  "description": "additionalVersions specifies a set api versions to require in addition to\nthe default selection. It is explicitly permitted to specify a version in\nadditionalVersions which was also selected by the default selection. The\nselections will be merged and deduplicated.\n\nEach item must be at most 63 characters in length, and must must consist\nof only lowercase alphanumeric characters and hyphens, and must start\nwith an alphabetic character and end with an alphanumeric character.// with an alphabetic character and end with an alphanumeric character.\nAt most 32 additional versions may be specified.",
                  "type": "array",
                  "maxItems": 32,
                  "minItems": 1,
                  "items": {
                    "description": "APIVersionString is a string representing a kubernetes API version.",
                    "type": "string",
                    "maxLength": 63,
                    "minLength": 1,
                    "x-kubernetes-validations": [
                      {
                        "rule": "!format.dns1035Label().validate(self).hasValue()",
                        "message": "It must contain only lower-case alphanumeric characters and hyphens and must start with an alphabetic character and end with an alphanumeric character"
                      }
                    ]
                  },
                  "x-kubernetes-list-type": "set"
                },
                "defaultSelection": {
                  "description": "defaultSelection specifies a method for automatically selecting a set of\nversions to require.\n\nValid options are StorageOnly and AllServed.\nWhen set to StorageOnly, only the storage version is selected for\ncompatibility assessment.\nWhen set to AllServed, all served versions are selected for compatibility\nassessment.\n\nThis field is required.",
                  "type": "string",
                  "enum": [
                    "StorageOnly",
                    "AllServed"
                  ]
                }
              },
              "additionalProperties": false,
              "x-kubernetes-validations": [
                {
                  "rule": "self.defaultSelection != 'AllServed' || !has(self.additionalVersions)",
                  "message": "additionalVersions may not be defined when defaultSelection is 'AllServed'"
                }
              ]
            }
          },
          "additionalProperties": false
        },
        "customResourceDefinitionSchemaValidation": {
          "description": "customResourceDefinitionSchemaValidation ensures that updates to the\ninstalled CRD are compatible with this compatibility requirement. If not\nspecified, admission of the target CRD will not be validated.\nThis field is optional.",
          "type": "object",
          "required": [
            "action"
          ],
          "properties": {
            "action": {
              "description": "action determines whether violations are rejected (Deny) or admitted with an API warning (Warn).\nValid options are Deny and Warn.\nWhen set to Deny, incompatible CRDs will be rejected and not admitted to the cluster.\nWhen set to Warn, incompatible CRDs will be allowed but a warning will be generated in the API response.\nThis field is required.",
              "type": "string",
              "enum": [
                "Deny",
                "Warn"
              ]
            }
          },
          "additionalProperties": false
        },
        "objectSchemaValidation": {
          "description": "objectSchemaValidation ensures that matching resources conform to\ncompatibilitySchema. If not specified, admission of matching resources\nwill not be validated.\nThis field is optional.",
          "type": "object",
          "required": [
            "action"
          ],
          "properties": {
            "action": {
              "description": "action determines whether violations are rejected (Deny) or admitted with an API warning (Warn).\nValid options are Deny and Warn.\nWhen set to Deny, incompatible Objects will be rejected and not admitted to the cluster.\nWhen set to Warn, incompatible Objects will be allowed but a warning will be generated in the API response.\nThis field is required.",
              "type": "string",
              "enum": [
                "Deny",
                "Warn"
              ]
            },
            "matchConditions": {
              "description": "matchConditions defines the matchConditions field of the resulting ValidatingWebhookConfiguration.\nWhen present, must contain between 1 and 64 match conditions.\nWhen not specified, the webhook will match all requests according to its other selectors.",
              "type": "array",
              "maxItems": 64,
              "minItems": 1,
              "items": {
                "description": "MatchCondition represents a condition which must by fulfilled for a request to be sent to a webhook.",
                "type": "object",
                "required": [
                  "expression",
                  "name"
                ],
                "properties": {
                  "expression": {
                    "description": "Expression represents the expression which will be evaluated by CEL. Must evaluate to bool.\nCEL expressions have access to the contents of the AdmissionRequest and Authorizer, organized into CEL variables:\n\n'object' - The object from the incoming request. The value is null for DELETE requests.\n'oldObject' - The existing object. The value is null for CREATE requests.\n'request' - Attributes of the admission request(/pkg/apis/admission/types.go#AdmissionRequest).\n'authorizer' - A CEL Authorizer. May be used to perform authorization checks for the principal (user or service account) of the request.\n  See https://pkg.go.dev/k8s.io/apiserver/pkg/cel/library#Authz\n'authorizer.requestResource' - A CEL ResourceCheck constructed from the 'authorizer' and configured with the\n  request resource.\nDocumentation on CEL: https://kubernetes.io/docs/reference/using-api/cel/\n\nRequired.",
                    "type": "string"
                  },
                  "name": {
                    "description": "Name is an identifier for this match condition, used for strategic merging of MatchConditions,\nas well as providing an identifier for logging purposes. A good name should be descriptive of\nthe associated expression.\nName must be a qualified name consisting of alphanumeric characters, '-', '_' or '.', and\nmust start and end with an alphanumeric character (e.g. 'MyName',  or 'my.name',  or\n'123-abc', regex used for validation is '([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]') with an\noptional DNS subdomain prefix and '/' (e.g. 'example.com/MyName')\n\nRequired.",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "x-kubernetes-list-map-keys": [
                "name"
              ],
              "x-kubernetes-list-type": "map"
            },
            "namespaceSelector": {
              "description": "namespaceSelector defines a label selector for namespaces. If defined,\nonly objects in a namespace with matching labels will be subject to\nvalidation. When not specified, objects for validation will not be\nfiltered by namespace.",
              "type": "object",
              "properties": {
                "matchExpressions": {
                  "description": "matchExpressions is a list of label selector requirements. The requirements are ANDed.",
                  "type": "array",
                  "items": {
                    "description": "A label selector requirement is a selector that contains values, a key, and an operator that\nrelates the key and values.",
                    "type": "object",
                    "required": [
                      "key",
                      "operator"
                    ],
                    "properties": {
                      "key": {
                        "description": "key is the label key that the selector applies to.",
                        "type": "string"
                      },
                      "operator": {
                        "description": "operator represents a key's relationship to a set of values.\nValid operators are In, NotIn, Exists and DoesNotExist.",
                        "type": "string"
                      },
                      "values": {
                        "description": "values is an array of string values. If the operator is In or NotIn,\nthe values array must be non-empty. If the operator is Exists or DoesNotExist,\nthe values array must be empty. This array is replaced during a strategic\nmerge patch.",
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "x-kubernetes-list-type": "atomic"
                      }
                    },
                    "additionalProperties": false
                  },
                  "x-kubernetes-list-type": "atomic"
                },
                "matchLabels": {
                  "description": "matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\nmap is equivalent to an element of matchExpressions, whose key field is \"key\", the\noperator is \"In\", and the values array contains only \"value\". The requirements are ANDed.",
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false,
              "x-kubernetes-map-type": "atomic",
              "x-kubernetes-validations": [
                {
                  "rule": "size(self.matchLabels) \u003e 0 || size(self.matchExpressions) \u003e 0",
                  "message": "must have at least one of matchLabels or matchExpressions when specified"
                }
              ]
            },
            "objectSelector": {
              "description": "objectSelector defines a label selector for objects. If defined, only\nobjects with matching labels will be subject to validation. When not\nspecified, objects for validation will not be filtered by label.",
              "type": "object",
              "properties": {
                "matchExpressions": {
                  "description": "matchExpressions is a list of label selector requirements. The requirements are ANDed.",
                  "type": "array",
                  "items": {
                    "description": "A label selector requirement is a selector that contains values, a key, and an operator that\nrelates the key and values.",
                    "type": "object",
                    "required": [
                      "key",
                      "operator"
                    ],
                    "properties": {
                      "key": {
                        "description": "key is the label key that the selector applies to.",
                        "type": "string"
                      },
                      "operator": {
                        "description": "operator represents a key's relationship to a set of values.\nValid operators are In, NotIn, Exists and DoesNotExist.",
                        "type": "string"
                      },
                      "values": {
                        "description": "values is an array of string values. If the operator is In or NotIn,\nthe values array must be non-empty. If the operator is Exists or DoesNotExist,\nthe values array must be empty. This array is replaced during a strategic\nmerge patch.",
                        "type": "array",
                        "items": {
                          "type": "string"
                        },
                        "x-kubernetes-list-type": "atomic"
                      }
                    },
                    "additionalProperties": false
                  },
                  "x-kubernetes-list-type": "atomic"
                },
                "matchLabels": {
                  "description": "matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels\nmap is equivalent to an element of matchExpressions, whose key field is \"key\", the\noperator is \"In\", and the values array contains only \"value\". The requirements are ANDed.",
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false,
              "x-kubernetes-map-type": "atomic",
              "x-kubernetes-validations": [
                {
                  "rule": "size(self.matchLabels) \u003e 0 || size(self.matchExpressions) \u003e 0",
                  "message": "must have at least one of matchLabels or matchExpressions when specified"
                }
              ]
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "status": {
      "description": "status is the most recently observed status of the Compatibility Requirement.",
      "type": "object",
      "minProperties": 1,
      "properties": {
        "conditions": {
          "description": "conditions is a list of conditions and their status.\nKnown condition types are Progressing, Admitted, and Compatible.\n\nThe Progressing condition indicates if reconciliation of a CompatibilityRequirement is still\nprogressing or has finished.\n\nThe Admitted condition indicates if the validating webhook has been configured.\n\nThe Compatible condition indicates if the observed CRD is compatible with the requirement.",
          "type": "array",
          "maxItems": 32,
          "minItems": 1,
          "items": {
            "description": "Condition contains details for one aspect of the current state of this API Resource.",
            "type": "object",
            "required": [
              "lastTransitionTime",
              "message",
              "reason",
              "status",
              "type"
            ],
            "properties": {
              "lastTransitionTime": {
                "description": "lastTransitionTime is the last time the condition transitioned from one status to another.\nThis should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.",
                "type": "string",
                "format": "date-time"
              },
              "message": {
                "description": "message is a human readable message indicating details about the transition.\nThis may be an empty string.",
                "type": "string",
                "maxLength": 32768
              },
              "observedGeneration": {
                "description": "observedGeneration represents the .metadata.generation that the condition was set based upon.\nFor instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date\nwith respect to the current state of the instance.",
                "type": "integer",
                "format": "int64",
                "minimum": 0
              },
              "reason": {
                "description": "reason contains a programmatic identifier indicating the reason for the condition's last transition.\nProducers of specific condition types may define expected values and meanings for this field,\nand whether the values are considered a guaranteed API.\nThe value should be a CamelCase string.\nThis field may not be empty.",
                "type": "string",
                "maxLength": 1024,
                "minLength": 1,
                "pattern": "^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$"
              },
              "status": {
                "description": "status of the condition, one of True, False, Unknown.",
                "type": "string",
                "enum": [
                  "True",
                  "False",
                  "Unknown"
                ]
              },
              "type": {
                "description": "type of condition in CamelCase or in foo.example.com/CamelCase.",
                "type": "string",
                "maxLength": 316,
                "pattern": "^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$"
              }
            },
            "additionalProperties": false
          },
          "x-kubernetes-list-map-keys": [
            "type"
          ],
          "x-kubernetes-list-type": "map"
        },
        "crdName": {
          "description": "crdName is the name of the target CRD. The target CRD is not required to\nexist, as we may legitimately place requirements on it before it is\ncreated.  The observed CRD is given in status.observedCRD, which will be\nempty if no CRD is observed.\nWhen present, must be between 1 and 253 characters and conform to RFC 1123 subdomain format:\nlowercase alphanumeric characters, '-' or '.', starting and ending with alphanumeric characters.\nWhen not specified, the requirement applies to any CRD name discovered from the compatibility schema.\nThis field is optional. Once set, the value cannot be changed and must always remain set.",
          "type": "string",
          "maxLength": 253,
          "minLength": 1,
          "x-kubernetes-validations": [
            {
              "rule": "!format.dns1123Subdomain().validate(self).hasValue()",
              "message": "a lowercase RFC 1123 subdomain must consist of lower case alphanumeric characters, '-' or '.', and must start and end with an alphanumeric character."
            }
          ]
        },
        "observedCRD": {
          "description": "observedCRD documents the uid and generation of the CRD object when the current status was written.\nThis field will be omitted if the target CRD does not exist or could not be retrieved.",
          "type": "object",
          "required": [
            "generation",
            "uid"
          ],
          "properties": {
            "generation": {
              "description": "generation is the observed generation of the CRD.\nMust be a positive integer (minimum value of 1).",
              "type": "integer",
              "format": "int64",
              "minimum": 1
            },
            "uid": {
              "description": "uid is the uid of the observed CRD.\nMust be a valid UUID consisting of lowercase hexadecimal digits in 5 hyphenated blocks (8-4-4-4-12 format).\nLength must be between 1 and 36 characters.",
              "type": "string",
              "format": "uuid",
              "maxLength": 36,
              "minLength": 1
            }
          },
          "additionalProperties": false,
          "x-kubernetes-validations": [
            {
              "rule": "oldSelf.uid != self.uid || self.generation \u003e= oldSelf.generation",
              "message": "generation may only increase on the same CRD"
            }
          ]
        }
      },
      "additionalProperties": false,
      "x-kubernetes-validations": [
        {
          "rule": "!has(oldSelf.crdName) || has(self.crdName) \u0026\u0026 oldSelf.crdName == self.crdName",
          "message": "crdName cannot be changed once set"
        }
      ]
    }
  }
}
