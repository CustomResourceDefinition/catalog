{
  "description": "ListenerRuleConfiguration is the Schema for the ListenerRuleConfiguration API",
  "type": "object",
  "properties": {
    "apiVersion": {
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources",
      "type": "string"
    },
    "kind": {
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds",
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "description": "ListenerRuleConfigurationSpec defines the desired state of ListenerRuleConfiguration",
      "type": "object",
      "properties": {
        "actions": {
          "description": "Actions defines the set of actions to be performed when conditions match.\nThis CRD implementation currently supports only  authenticate-oidc, authenticate-cognito, and fixed-response action types fully and forward and redirect actions partially\n\nFor other fields in forward and redirect actions, please use the standard Gateway API HTTPRoute or other route resources, which provide\nnative support for those conditions through the Gateway API specification.\n\nAt most one authentication action can be specified (either authenticate-oidc or authenticate-cognito).",
          "type": "array",
          "maxItems": 2,
          "minItems": 1,
          "items": {
            "description": "Action defines an action for a listener rule",
            "type": "object",
            "required": [
              "type"
            ],
            "properties": {
              "authenticateCognitoConfig": {
                "description": "Information for an authenticate-cognito action",
                "type": "object",
                "required": [
                  "userPoolArn",
                  "userPoolClientId",
                  "userPoolDomain"
                ],
                "properties": {
                  "authenticationRequestExtraParams": {
                    "description": "The query parameters (up to 10) to include in the redirect request to the\nauthorization endpoint.",
                    "type": "object",
                    "maxProperties": 10,
                    "additionalProperties": {
                      "type": "string"
                    }
                  },
                  "onUnauthenticatedRequest": {
                    "description": "The behavior if the user is not authenticated. The following are possible",
                    "type": "string",
                    "default": "authenticate",
                    "enum": [
                      "deny",
                      "allow",
                      "authenticate"
                    ]
                  },
                  "scope": {
                    "description": "The set of user claims to be requested from the IdP. The default is openid .\n\nTo verify which scope values your IdP supports and how to separate multiple\nvalues, see the documentation for your IdP.",
                    "type": "string",
                    "default": "openid"
                  },
                  "sessionCookieName": {
                    "description": "The name of the cookie used to maintain session information. The default is\nAWSELBAuthSessionCookie.",
                    "type": "string",
                    "default": "AWSELBAuthSessionCookie"
                  },
                  "sessionTimeout": {
                    "description": "The maximum duration of the authentication session, in seconds. The default is\n604800 seconds (7 days).",
                    "type": "integer",
                    "format": "int64",
                    "default": 604800,
                    "maximum": 604800,
                    "minimum": 1
                  },
                  "userPoolArn": {
                    "description": "The Amazon Resource Name (ARN) of the Amazon Cognito user pool.",
                    "type": "string"
                  },
                  "userPoolClientId": {
                    "description": "The ID of the Amazon Cognito user pool client.",
                    "type": "string"
                  },
                  "userPoolDomain": {
                    "description": "The domain prefix or fully-qualified domain name of the Amazon Cognito user\npool.",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "authenticateOIDCConfig": {
                "description": "Information for an authenticate-oidc action",
                "type": "object",
                "required": [
                  "authorizationEndpoint",
                  "issuer",
                  "secret",
                  "tokenEndpoint",
                  "userInfoEndpoint"
                ],
                "properties": {
                  "authenticationRequestExtraParams": {
                    "description": "The query parameters (up to 10) to include in the redirect request to the\nauthorization endpoint.",
                    "type": "object",
                    "maxProperties": 10,
                    "additionalProperties": {
                      "type": "string"
                    }
                  },
                  "authorizationEndpoint": {
                    "description": "The authorization endpoint of the IdP. This must be a full URL, including the\nHTTPS protocol, the domain, and the path.",
                    "type": "string"
                  },
                  "issuer": {
                    "description": "The OIDC issuer identifier of the IdP. This must be a full URL, including the\nHTTPS protocol, the domain, and the path.",
                    "type": "string"
                  },
                  "onUnauthenticatedRequest": {
                    "description": "The behavior if the user is not authenticated. The following are possible",
                    "type": "string",
                    "default": "authenticate",
                    "enum": [
                      "deny",
                      "allow",
                      "authenticate"
                    ]
                  },
                  "scope": {
                    "description": "The set of user claims to be requested from the IdP. The default is openid .\n\nTo verify which scope values your IdP supports and how to separate multiple\nvalues, see the documentation for your IdP.",
                    "type": "string",
                    "default": "openid"
                  },
                  "secret": {
                    "description": "Secret holds OAuth 2.0 clientID and clientSecret. You need to create this secret and provide its name and namespace",
                    "type": "object",
                    "required": [
                      "name"
                    ],
                    "properties": {
                      "name": {
                        "description": "Name is name of the secret",
                        "type": "string"
                      }
                    },
                    "additionalProperties": false
                  },
                  "sessionCookieName": {
                    "description": "The name of the cookie used to maintain session information. The default is\nAWSELBAuthSessionCookie.",
                    "type": "string",
                    "default": "AWSELBAuthSessionCookie"
                  },
                  "sessionTimeout": {
                    "description": "The maximum duration of the authentication session, in seconds. The default is\n604800 seconds (7 days).",
                    "type": "integer",
                    "format": "int64",
                    "default": 604800,
                    "maximum": 604800,
                    "minimum": 1
                  },
                  "tokenEndpoint": {
                    "description": "The token endpoint of the IdP. This must be a full URL, including the HTTPS\nprotocol, the domain, and the path.",
                    "type": "string"
                  },
                  "useExistingClientSecret": {
                    "description": "Indicates whether to use the existing client secret when modifying a listener rule. If\nyou are creating a listener rule, you can omit this parameter or set it to false.",
                    "type": "boolean"
                  },
                  "userInfoEndpoint": {
                    "description": "The user info endpoint of the IdP. This must be a full URL, including the HTTPS\nprotocol, the domain, and the path.",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "fixedResponseConfig": {
                "description": "Information for a fixed-response action",
                "type": "object",
                "required": [
                  "statusCode"
                ],
                "properties": {
                  "contentType": {
                    "description": "The content type of the fixed response.",
                    "type": "string",
                    "default": "text/plain",
                    "enum": [
                      "text/plain",
                      "text/css",
                      "text/html",
                      "application/javascript",
                      "application/json"
                    ]
                  },
                  "messageBody": {
                    "description": "The message",
                    "type": "string"
                  },
                  "statusCode": {
                    "description": "The HTTP response code (2XX, 4XX, or 5XX).",
                    "type": "integer",
                    "format": "int32",
                    "x-kubernetes-validations": [
                      {
                        "rule": "(self \u003e= 200 \u0026\u0026 self \u003c= 299) || (self \u003e= 400 \u0026\u0026 self \u003c= 599)",
                        "message": "StatusCode must be a valid HTTP status code in the 2XX, 4XX, or 5XX range"
                      }
                    ]
                  }
                },
                "additionalProperties": false
              },
              "forwardConfig": {
                "description": "Information for a forward action",
                "type": "object",
                "properties": {
                  "targetGroupStickinessConfig": {
                    "description": "The target group stickiness for the rule.\nNote: ForwardActionConfig only supports target group stickiness configuration through CRD.\nAll other forward action fields must be set through the Gateway API native way.",
                    "type": "object",
                    "default": {},
                    "properties": {
                      "durationSeconds": {
                        "description": "The time period, in seconds, during which requests from a client should be\nrouted to the same target group. The range is 1-604800 seconds (7 days).",
                        "type": "integer",
                        "format": "int32",
                        "default": 3600,
                        "maximum": 604800,
                        "minimum": 1
                      },
                      "enabled": {
                        "description": "Indicates whether target group stickiness is enabled.",
                        "type": "boolean",
                        "default": false
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "redirectConfig": {
                "description": "Information for a redirect action",
                "type": "object",
                "properties": {
                  "query": {
                    "description": "The query parameters, URL-encoded when necessary, but not percent-encoded. Do\nnot include the leading \"?\", as it is automatically added. You can specify any\nof the reserved keywords.\nNote: RedirectActionConfig only supports setting the query parameter through CRD.\nAll other redirect action fields must be set through the Gateway API native way.",
                    "type": "string",
                    "default": "#{query}"
                  }
                },
                "additionalProperties": false
              },
              "type": {
                "description": "The type of action",
                "type": "string",
                "enum": [
                  "forward",
                  "fixed-response",
                  "redirect",
                  "authenticate-cognito",
                  "authenticate-oidc"
                ]
              }
            },
            "additionalProperties": false,
            "x-kubernetes-validations": [
              {
                "rule": "has(self.type) \u0026\u0026 self.type == 'forward' ? has(self.forwardConfig) : !has(self.forwardConfig)",
                "message": "forwardConfig must be specified only when type is 'forward'"
              },
              {
                "rule": "has(self.type) \u0026\u0026 self.type == 'redirect' ? has(self.redirectConfig) : !has(self.redirectConfig)",
                "message": "redirectConfig must be specified only when type is 'redirect'"
              },
              {
                "rule": "has(self.type) \u0026\u0026 self.type == 'fixed-response' ? has(self.fixedResponseConfig) : !has(self.fixedResponseConfig)",
                "message": "fixedResponseConfig must be specified only when type is 'fixed-response'"
              },
              {
                "rule": "has(self.type) \u0026\u0026 self.type == 'authenticate-cognito' ? has(self.authenticateCognitoConfig) : !has(self.authenticateCognitoConfig)",
                "message": "authenticateCognitoConfig must be specified only when type is 'authenticate-cognito'"
              },
              {
                "rule": "has(self.type) \u0026\u0026 self.type == 'authenticate-oidc' ? has(self.authenticateOIDCConfig) : !has(self.authenticateOIDCConfig)",
                "message": "authenticateOIDCConfig must be specified only when type is 'authenticate-oidc'"
              }
            ]
          }
        },
        "conditions": {
          "description": "Conditions defines the circumstances under which the rule actions will be performed.\nThis CRD implementation currently supports only the source-ip condition type\n\nFor other condition types (such as path-pattern, host-header, http-header, etc.),\nplease use the standard Gateway API HTTPRoute or other route resources, which provide\nnative support for those conditions through the Gateway API specification.",
          "type": "array",
          "minItems": 1,
          "items": {
            "description": "Information about a condition for a listener rule",
            "type": "object",
            "required": [
              "field"
            ],
            "properties": {
              "field": {
                "description": "The field in the HTTP request",
                "type": "string",
                "enum": [
                  "source-ip"
                ]
              },
              "matchIndexes": {
                "description": "Indexes of Match in a rule to apply source ip to\nIf MatchIndexes is not provided, SourceIpConfig will be applied to all conditions where ListenerRuleConfiguration is used",
                "type": "array",
                "items": {
                  "type": "integer"
                }
              },
              "sourceIPConfig": {
                "description": "Information for a source IP condition",
                "type": "object",
                "required": [
                  "values"
                ],
                "properties": {
                  "values": {
                    "description": "One or more source IP addresses, in CIDR format",
                    "type": "array",
                    "minItems": 1,
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false,
            "x-kubernetes-validations": [
              {
                "rule": "has(self.field) \u0026\u0026 self.field == 'source-ip' ? has(self.sourceIPConfig) : !has(self.sourceIPConfig)",
                "message": "sourceIPConfig must be specified only when field is 'source-ip'"
              }
            ]
          }
        },
        "tags": {
          "description": "Tags are the AWS resource tags to be applied to all AWS resources created for this rule.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false,
      "x-kubernetes-validations": [
        {
          "rule": "!has(self.actions) || size(self.actions) \u003e 0",
          "message": "At least one action must be specified if actions field is present"
        },
        {
          "rule": "!has(self.actions) || self.actions.all(a, a.type == 'authenticate-oidc' || a.type == 'authenticate-cognito' || a.type == 'fixed-response' || a.type == 'forward' || a.type == 'redirect')",
          "message": "Only forward, redirect, authenticate-oidc, authenticate-cognito, and fixed-response action types are supported"
        },
        {
          "rule": "!has(self.actions) || size(self.actions.filter(a, a.type == 'authenticate-oidc' || a.type == 'authenticate-cognito')) \u003c= 1",
          "message": "At most one authentication action (either authenticate-oidc or authenticate-cognito) can be specified"
        },
        {
          "rule": "!has(self.actions) || size(self.actions.filter(a, a.type == 'fixed-response' || a.type == 'forward' || a.type == 'redirect')) \u003c= 1",
          "message": "At most one routing action (fixed-response or forward or redirect) can be specified"
        }
      ]
    },
    "status": {
      "description": "ListenerRuleConfigurationStatus defines the observed state of ListenerRuleConfiguration",
      "type": "object",
      "properties": {
        "accepted": {
          "description": "Accepted indicates whether ListenerRuleConfiguration is valid",
          "type": "boolean"
        },
        "message": {
          "description": "Message provides details about the current state",
          "type": "string"
        },
        "observedGeneration": {
          "description": "The observed generation of the rule configuration",
          "type": "integer",
          "format": "int64"
        }
      },
      "additionalProperties": false
    }
  }
}
