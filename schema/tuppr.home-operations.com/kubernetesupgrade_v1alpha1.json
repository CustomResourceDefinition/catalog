{
  "description": "KubernetesUpgrade is the Schema for the kubernetesupgrades API",
  "type": "object",
  "properties": {
    "apiVersion": {
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources",
      "type": "string"
    },
    "kind": {
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds",
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "description": "KubernetesUpgradeSpec defines the desired state of KubernetesUpgrade",
      "type": "object",
      "required": [
        "kubernetes"
      ],
      "properties": {
        "healthChecks": {
          "description": "HealthChecks defines a list of CEL-based health checks to perform before the upgrade",
          "type": "array",
          "items": {
            "description": "HealthCheck defines a CEL-based health check",
            "type": "object",
            "required": [
              "apiVersion",
              "expr",
              "kind"
            ],
            "properties": {
              "apiVersion": {
                "description": "APIVersion of the resource to check",
                "type": "string"
              },
              "description": {
                "description": "Description of what this check validates (for status/logging)",
                "type": "string"
              },
              "expr": {
                "description": "CEL expression that must evaluate to true for the check to pass\nThe resource object is available as 'object' and status as 'status'",
                "type": "string"
              },
              "kind": {
                "description": "Kind of the resource to check",
                "type": "string"
              },
              "name": {
                "description": "Name of the specific resource (optional, if empty checks all resources of this kind)",
                "type": "string"
              },
              "namespace": {
                "description": "Namespace of the resource (optional, for namespaced resources)",
                "type": "string"
              },
              "timeout": {
                "description": "Timeout for this health check",
                "type": "string",
                "minLength": 2,
                "pattern": "^([0-9]+[smh])+$"
              }
            },
            "additionalProperties": false
          }
        },
        "kubernetes": {
          "description": "Kubernetes defines the target Kubernetes configuration",
          "type": "object",
          "required": [
            "version"
          ],
          "properties": {
            "version": {
              "description": "Version is the target Kubernetes version to upgrade to (e.g., \"v1.34.0\")",
              "type": "string",
              "pattern": "^v[0-9]+\\.[0-9]+\\.[0-9]+(-[a-zA-Z0-9\\-\\.]+)?$"
            }
          },
          "additionalProperties": false
        },
        "maintenance": {
          "description": "Maintenance configuration behavior for upgrade operations",
          "type": "object",
          "properties": {
            "windows": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": [
                  "duration",
                  "start"
                ],
                "properties": {
                  "duration": {
                    "description": "How long the window stays open (e.g., \"4h\", \"2h30m\")",
                    "type": "string",
                    "pattern": "^([0-9]+[smh])+$"
                  },
                  "start": {
                    "description": "Cron expression (5-field): minute hour day-of-month month day-of-week",
                    "type": "string",
                    "minLength": 9
                  },
                  "timezone": {
                    "description": "IANA timezone (e.g., \"UTC\", \"Europe/Paris\")",
                    "type": "string",
                    "default": "UTC"
                  }
                },
                "additionalProperties": false
              }
            }
          },
          "additionalProperties": false
        },
        "talosctl": {
          "description": "Talosctl specifies the talosctl configuration for upgrade operations",
          "type": "object",
          "properties": {
            "image": {
              "description": "Image specifies the talosctl container image",
              "type": "object",
              "properties": {
                "pullPolicy": {
                  "description": "PullPolicy describes a policy for if/when to pull a container image",
                  "type": "string",
                  "default": "IfNotPresent",
                  "enum": [
                    "Always",
                    "Never",
                    "IfNotPresent"
                  ]
                },
                "repository": {
                  "description": "Repository is the talosctl container image repository",
                  "type": "string",
                  "default": "ghcr.io/siderolabs/talosctl"
                },
                "tag": {
                  "description": "Tag is the talosctl container image tag\nIf not specified, defaults to the target version",
                  "type": "string"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "status": {
      "description": "KubernetesUpgradeStatus defines the observed state of KubernetesUpgrade",
      "type": "object",
      "properties": {
        "controllerNode": {
          "description": "ControllerNode is the controller node being used for the upgrade",
          "type": "string"
        },
        "currentVersion": {
          "description": "CurrentVersion is the current Kubernetes version detected in the cluster",
          "type": "string"
        },
        "jobName": {
          "description": "JobName is the name of the job handling the upgrade",
          "type": "string"
        },
        "lastError": {
          "description": "LastError contains the last error message",
          "type": "string"
        },
        "lastUpdated": {
          "description": "LastUpdated timestamp of last status update",
          "type": "string",
          "format": "date-time"
        },
        "message": {
          "description": "Message provides details about the current state",
          "type": "string"
        },
        "nextMaintenanceWindow": {
          "description": "NextMaintenanceWindow reflect the next time a maintenance can happen",
          "type": "string",
          "format": "date-time"
        },
        "observedGeneration": {
          "description": "ObservedGeneration reflects the generation of the most recently observed spec",
          "type": "integer",
          "format": "int64"
        },
        "phase": {
          "description": "Phase represents the current phase of the upgrade",
          "type": "string",
          "allOf": [
            {
              "enum": [
                "Pending",
                "HealthChecking",
                "Draining",
                "Upgrading",
                "Rebooting",
                "Completed",
                "Failed",
                "MaintenanceWindow"
              ]
            },
            {
              "enum": [
                "Pending",
                "HealthChecking",
                "Draining",
                "Upgrading",
                "Rebooting",
                "Completed",
                "Failed"
              ]
            }
          ]
        },
        "retries": {
          "description": "Retries is the number of times the upgrade was attempted",
          "type": "integer",
          "minimum": 0
        },
        "targetVersion": {
          "description": "TargetVersion is the target version from the spec",
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  }
}
