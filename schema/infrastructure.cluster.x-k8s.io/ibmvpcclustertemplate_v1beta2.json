{
  "properties": {
    "apiVersion": {
      "type": "string"
    },
    "kind": {
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "additionalProperties": false,
      "properties": {
        "template": {
          "additionalProperties": false,
          "properties": {
            "metadata": {
              "additionalProperties": false,
              "properties": {
                "annotations": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object"
                },
                "labels": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object"
                }
              },
              "type": "object"
            },
            "spec": {
              "additionalProperties": false,
              "properties": {
                "controlPlaneEndpoint": {
                  "additionalProperties": false,
                  "properties": {
                    "host": {
                      "type": "string"
                    },
                    "port": {
                      "format": "int32",
                      "type": "integer"
                    }
                  },
                  "required": [
                    "host",
                    "port"
                  ],
                  "type": "object"
                },
                "controlPlaneLoadBalancer": {
                  "additionalProperties": false,
                  "properties": {
                    "additionalListeners": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "defaultPoolName": {
                            "maxLength": 63,
                            "minLength": 1,
                            "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                            "type": "string"
                          },
                          "port": {
                            "format": "int64",
                            "maximum": 65535,
                            "minimum": 1,
                            "type": "integer"
                          },
                          "protocol": {
                            "enum": [
                              "http",
                              "https",
                              "tcp",
                              "udp"
                            ],
                            "type": "string"
                          }
                        },
                        "required": [
                          "port"
                        ],
                        "type": "object"
                      },
                      "type": "array",
                      "x-kubernetes-list-map-keys": [
                        "port"
                      ],
                      "x-kubernetes-list-type": "map"
                    },
                    "backendPools": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "algorithm": {
                            "enum": [
                              "least_connections",
                              "round_robin",
                              "weighted_round_robin"
                            ],
                            "type": "string"
                          },
                          "healthMonitor": {
                            "additionalProperties": false,
                            "properties": {
                              "delay": {
                                "format": "int64",
                                "maximum": 60,
                                "minimum": 2,
                                "type": "integer"
                              },
                              "port": {
                                "format": "int64",
                                "maximum": 65535,
                                "minimum": 1,
                                "type": "integer"
                              },
                              "retries": {
                                "format": "int64",
                                "maximum": 10,
                                "minimum": 1,
                                "type": "integer"
                              },
                              "timeout": {
                                "format": "int64",
                                "maximum": 59,
                                "minimum": 1,
                                "type": "integer"
                              },
                              "type": {
                                "enum": [
                                  "http",
                                  "https",
                                  "tcp"
                                ],
                                "type": "string"
                              },
                              "urlPath": {
                                "pattern": "^\\/(([a-zA-Z0-9-._~!$&'()*+,;=:@]|%[a-fA-F0-9]{2})+(\\/([a-zA-Z0-9-._~!$&'()*+,;=:@]|%[a-fA-F0-9]{2})*)*)?(\\\\?([a-zA-Z0-9-._~!$&'()*+,;=:@\\/?]|%[a-fA-F0-9]{2})*)?$",
                                "type": "string"
                              }
                            },
                            "required": [
                              "delay",
                              "retries",
                              "timeout",
                              "type"
                            ],
                            "type": "object"
                          },
                          "name": {
                            "maxLength": 63,
                            "minLength": 1,
                            "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                            "type": "string"
                          },
                          "protocol": {
                            "enum": [
                              "http",
                              "https",
                              "tcp",
                              "udp"
                            ],
                            "type": "string"
                          }
                        },
                        "required": [
                          "algorithm",
                          "healthMonitor",
                          "protocol"
                        ],
                        "type": "object"
                      },
                      "type": "array"
                    },
                    "id": {
                      "maxLength": 64,
                      "minLength": 1,
                      "pattern": "^[-0-9a-z_]+$",
                      "type": "string"
                    },
                    "name": {
                      "maxLength": 63,
                      "minLength": 1,
                      "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                      "type": "string"
                    },
                    "public": {
                      "default": true,
                      "type": "boolean"
                    },
                    "securityGroups": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "id": {
                            "minLength": 1,
                            "type": "string"
                          },
                          "name": {
                            "minLength": 1,
                            "type": "string"
                          }
                        },
                        "type": "object",
                        "x-kubernetes-validations": [
                          {
                            "message": "an id or name must be provided",
                            "rule": "has(self.id) || has(self.name)"
                          }
                        ]
                      },
                      "type": "array"
                    },
                    "subnets": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "id": {
                            "minLength": 1,
                            "type": "string"
                          },
                          "name": {
                            "minLength": 1,
                            "type": "string"
                          }
                        },
                        "type": "object",
                        "x-kubernetes-validations": [
                          {
                            "message": "an id or name must be provided",
                            "rule": "has(self.id) || has(self.name)"
                          }
                        ]
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                },
                "image": {
                  "additionalProperties": false,
                  "properties": {
                    "cosBucket": {
                      "type": "string"
                    },
                    "cosBucketRegion": {
                      "type": "string"
                    },
                    "cosInstance": {
                      "type": "string"
                    },
                    "cosObject": {
                      "type": "string"
                    },
                    "crn": {
                      "type": "string"
                    },
                    "name": {
                      "maxLength": 63,
                      "minLength": 1,
                      "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                      "type": "string"
                    },
                    "operatingSystem": {
                      "type": "string"
                    },
                    "resourceGroup": {
                      "additionalProperties": false,
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id"
                      ],
                      "type": "object"
                    }
                  },
                  "type": "object",
                  "x-kubernetes-validations": [
                    {
                      "message": "if any of cosInstance, cosBucket, or cosObject are specified, all must be specified",
                      "rule": "(!has(self.cosInstance) && !has(self.cosBucket) && !has(self.cosObject)) || (has(self.cosInstance) && has(self.cosBucket) && has(self.cosObject))"
                    },
                    {
                      "message": "an existing image name or crn must be provided, or to create a new image the cos resources must be provided, with or without a name",
                      "rule": "has(self.name) || has(self.crn) || (has(self.cosInstance) && has(self.cosBucket) && has(self.cosObject))"
                    }
                  ]
                },
                "network": {
                  "additionalProperties": false,
                  "properties": {
                    "controlPlaneSubnets": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "cidr": {
                            "type": "string"
                          },
                          "id": {
                            "maxLength": 64,
                            "minLength": 1,
                            "pattern": "^[-0-9a-z_]+$",
                            "type": "string"
                          },
                          "name": {
                            "maxLength": 63,
                            "minLength": 1,
                            "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                            "type": "string"
                          },
                          "zone": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    },
                    "loadBalancers": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "additionalListeners": {
                            "items": {
                              "additionalProperties": false,
                              "properties": {
                                "defaultPoolName": {
                                  "maxLength": 63,
                                  "minLength": 1,
                                  "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                                  "type": "string"
                                },
                                "port": {
                                  "format": "int64",
                                  "maximum": 65535,
                                  "minimum": 1,
                                  "type": "integer"
                                },
                                "protocol": {
                                  "enum": [
                                    "http",
                                    "https",
                                    "tcp",
                                    "udp"
                                  ],
                                  "type": "string"
                                }
                              },
                              "required": [
                                "port"
                              ],
                              "type": "object"
                            },
                            "type": "array",
                            "x-kubernetes-list-map-keys": [
                              "port"
                            ],
                            "x-kubernetes-list-type": "map"
                          },
                          "backendPools": {
                            "items": {
                              "additionalProperties": false,
                              "properties": {
                                "algorithm": {
                                  "enum": [
                                    "least_connections",
                                    "round_robin",
                                    "weighted_round_robin"
                                  ],
                                  "type": "string"
                                },
                                "healthMonitor": {
                                  "additionalProperties": false,
                                  "properties": {
                                    "delay": {
                                      "format": "int64",
                                      "maximum": 60,
                                      "minimum": 2,
                                      "type": "integer"
                                    },
                                    "port": {
                                      "format": "int64",
                                      "maximum": 65535,
                                      "minimum": 1,
                                      "type": "integer"
                                    },
                                    "retries": {
                                      "format": "int64",
                                      "maximum": 10,
                                      "minimum": 1,
                                      "type": "integer"
                                    },
                                    "timeout": {
                                      "format": "int64",
                                      "maximum": 59,
                                      "minimum": 1,
                                      "type": "integer"
                                    },
                                    "type": {
                                      "enum": [
                                        "http",
                                        "https",
                                        "tcp"
                                      ],
                                      "type": "string"
                                    },
                                    "urlPath": {
                                      "pattern": "^\\/(([a-zA-Z0-9-._~!$&'()*+,;=:@]|%[a-fA-F0-9]{2})+(\\/([a-zA-Z0-9-._~!$&'()*+,;=:@]|%[a-fA-F0-9]{2})*)*)?(\\\\?([a-zA-Z0-9-._~!$&'()*+,;=:@\\/?]|%[a-fA-F0-9]{2})*)?$",
                                      "type": "string"
                                    }
                                  },
                                  "required": [
                                    "delay",
                                    "retries",
                                    "timeout",
                                    "type"
                                  ],
                                  "type": "object"
                                },
                                "name": {
                                  "maxLength": 63,
                                  "minLength": 1,
                                  "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                                  "type": "string"
                                },
                                "protocol": {
                                  "enum": [
                                    "http",
                                    "https",
                                    "tcp",
                                    "udp"
                                  ],
                                  "type": "string"
                                }
                              },
                              "required": [
                                "algorithm",
                                "healthMonitor",
                                "protocol"
                              ],
                              "type": "object"
                            },
                            "type": "array"
                          },
                          "id": {
                            "maxLength": 64,
                            "minLength": 1,
                            "pattern": "^[-0-9a-z_]+$",
                            "type": "string"
                          },
                          "name": {
                            "maxLength": 63,
                            "minLength": 1,
                            "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                            "type": "string"
                          },
                          "public": {
                            "default": true,
                            "type": "boolean"
                          },
                          "securityGroups": {
                            "items": {
                              "additionalProperties": false,
                              "properties": {
                                "id": {
                                  "minLength": 1,
                                  "type": "string"
                                },
                                "name": {
                                  "minLength": 1,
                                  "type": "string"
                                }
                              },
                              "type": "object",
                              "x-kubernetes-validations": [
                                {
                                  "message": "an id or name must be provided",
                                  "rule": "has(self.id) || has(self.name)"
                                }
                              ]
                            },
                            "type": "array"
                          },
                          "subnets": {
                            "items": {
                              "additionalProperties": false,
                              "properties": {
                                "id": {
                                  "minLength": 1,
                                  "type": "string"
                                },
                                "name": {
                                  "minLength": 1,
                                  "type": "string"
                                }
                              },
                              "type": "object",
                              "x-kubernetes-validations": [
                                {
                                  "message": "an id or name must be provided",
                                  "rule": "has(self.id) || has(self.name)"
                                }
                              ]
                            },
                            "type": "array"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    },
                    "resourceGroup": {
                      "additionalProperties": false,
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "id"
                      ],
                      "type": "object"
                    },
                    "securityGroups": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "rules": {
                            "items": {
                              "additionalProperties": false,
                              "properties": {
                                "action": {
                                  "enum": [
                                    "allow",
                                    "deny"
                                  ],
                                  "type": "string"
                                },
                                "destination": {
                                  "additionalProperties": false,
                                  "properties": {
                                    "icmpCode": {
                                      "format": "int64",
                                      "type": "integer"
                                    },
                                    "icmpType": {
                                      "format": "int64",
                                      "type": "integer"
                                    },
                                    "portRange": {
                                      "additionalProperties": false,
                                      "properties": {
                                        "maximumPort": {
                                          "format": "int64",
                                          "maximum": 65535,
                                          "minimum": 1,
                                          "type": "integer"
                                        },
                                        "minimumPort": {
                                          "format": "int64",
                                          "maximum": 65535,
                                          "minimum": 1,
                                          "type": "integer"
                                        }
                                      },
                                      "type": "object",
                                      "x-kubernetes-validations": [
                                        {
                                          "message": "maximum port must be greater than or equal to minimum port",
                                          "rule": "self.maximumPort >= self.minimumPort"
                                        }
                                      ]
                                    },
                                    "protocol": {
                                      "enum": [
                                        "all",
                                        "icmp",
                                        "tcp",
                                        "udp"
                                      ],
                                      "type": "string"
                                    },
                                    "remotes": {
                                      "items": {
                                        "additionalProperties": false,
                                        "properties": {
                                          "address": {
                                            "type": "string"
                                          },
                                          "cidrSubnetName": {
                                            "type": "string"
                                          },
                                          "remoteType": {
                                            "enum": [
                                              "any",
                                              "cidr",
                                              "address",
                                              "sg"
                                            ],
                                            "type": "string"
                                          },
                                          "securityGroupName": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "remoteType"
                                        ],
                                        "type": "object",
                                        "x-kubernetes-validations": [
                                          {
                                            "message": "cidrSubnetName, addresss, and securityGroupName are not valid for VPCSecurityGroupRuleRemoteTypeAny remoteType",
                                            "rule": "self.remoteType == 'any' ? (!has(self.cidrSubnetName) && !has(self.address) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only cidrSubnetName is valid for VPCSecurityGroupRuleRemoteTypeCIDR remoteType",
                                            "rule": "self.remoteType == 'cidr' ? (has(self.cidrSubnetName) && !has(self.address) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only address is valid for VPCSecurityGroupRuleRemoteTypeIP remoteType",
                                            "rule": "self.remoteType == 'address' ? (has(self.address) && !has(self.cidrSubnetName) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only securityGroupName is valid for VPCSecurityGroupRuleRemoteTypeSG remoteType",
                                            "rule": "self.remoteType == 'sg' ? (has(self.securityGroupName) && !has(self.cidrSubnetName) && !has(self.address)) : true"
                                          }
                                        ]
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "required": [
                                    "protocol",
                                    "remotes"
                                  ],
                                  "type": "object",
                                  "x-kubernetes-validations": [
                                    {
                                      "message": "icmpCode and icmpType are only supported for VPCSecurityGroupRuleProtocolIcmp protocol",
                                      "rule": "self.protocol != 'icmp' ? (!has(self.icmpCode) && !has(self.icmpType)) : true"
                                    },
                                    {
                                      "message": "portRange is not valid for VPCSecurityGroupRuleProtocolAll protocol",
                                      "rule": "self.protocol == 'all' ? !has(self.portRange) : true"
                                    },
                                    {
                                      "message": "portRange is not valid for VPCSecurityGroupRuleProtocolIcmp protocol",
                                      "rule": "self.protocol == 'icmp' ? !has(self.portRange) : true"
                                    }
                                  ]
                                },
                                "direction": {
                                  "enum": [
                                    "inbound",
                                    "outbound"
                                  ],
                                  "type": "string"
                                },
                                "securityGroupID": {
                                  "type": "string"
                                },
                                "source": {
                                  "additionalProperties": false,
                                  "properties": {
                                    "icmpCode": {
                                      "format": "int64",
                                      "type": "integer"
                                    },
                                    "icmpType": {
                                      "format": "int64",
                                      "type": "integer"
                                    },
                                    "portRange": {
                                      "additionalProperties": false,
                                      "properties": {
                                        "maximumPort": {
                                          "format": "int64",
                                          "maximum": 65535,
                                          "minimum": 1,
                                          "type": "integer"
                                        },
                                        "minimumPort": {
                                          "format": "int64",
                                          "maximum": 65535,
                                          "minimum": 1,
                                          "type": "integer"
                                        }
                                      },
                                      "type": "object",
                                      "x-kubernetes-validations": [
                                        {
                                          "message": "maximum port must be greater than or equal to minimum port",
                                          "rule": "self.maximumPort >= self.minimumPort"
                                        }
                                      ]
                                    },
                                    "protocol": {
                                      "enum": [
                                        "all",
                                        "icmp",
                                        "tcp",
                                        "udp"
                                      ],
                                      "type": "string"
                                    },
                                    "remotes": {
                                      "items": {
                                        "additionalProperties": false,
                                        "properties": {
                                          "address": {
                                            "type": "string"
                                          },
                                          "cidrSubnetName": {
                                            "type": "string"
                                          },
                                          "remoteType": {
                                            "enum": [
                                              "any",
                                              "cidr",
                                              "address",
                                              "sg"
                                            ],
                                            "type": "string"
                                          },
                                          "securityGroupName": {
                                            "type": "string"
                                          }
                                        },
                                        "required": [
                                          "remoteType"
                                        ],
                                        "type": "object",
                                        "x-kubernetes-validations": [
                                          {
                                            "message": "cidrSubnetName, addresss, and securityGroupName are not valid for VPCSecurityGroupRuleRemoteTypeAny remoteType",
                                            "rule": "self.remoteType == 'any' ? (!has(self.cidrSubnetName) && !has(self.address) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only cidrSubnetName is valid for VPCSecurityGroupRuleRemoteTypeCIDR remoteType",
                                            "rule": "self.remoteType == 'cidr' ? (has(self.cidrSubnetName) && !has(self.address) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only address is valid for VPCSecurityGroupRuleRemoteTypeIP remoteType",
                                            "rule": "self.remoteType == 'address' ? (has(self.address) && !has(self.cidrSubnetName) && !has(self.securityGroupName)) : true"
                                          },
                                          {
                                            "message": "only securityGroupName is valid for VPCSecurityGroupRuleRemoteTypeSG remoteType",
                                            "rule": "self.remoteType == 'sg' ? (has(self.securityGroupName) && !has(self.cidrSubnetName) && !has(self.address)) : true"
                                          }
                                        ]
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "required": [
                                    "protocol",
                                    "remotes"
                                  ],
                                  "type": "object",
                                  "x-kubernetes-validations": [
                                    {
                                      "message": "icmpCode and icmpType are only supported for VPCSecurityGroupRuleProtocolIcmp protocol",
                                      "rule": "self.protocol != 'icmp' ? (!has(self.icmpCode) && !has(self.icmpType)) : true"
                                    },
                                    {
                                      "message": "portRange is not valid for VPCSecurityGroupRuleProtocolAll protocol",
                                      "rule": "self.protocol == 'all' ? !has(self.portRange) : true"
                                    },
                                    {
                                      "message": "portRange is not valid for VPCSecurityGroupRuleProtocolIcmp protocol",
                                      "rule": "self.protocol == 'icmp' ? !has(self.portRange) : true"
                                    }
                                  ]
                                }
                              },
                              "required": [
                                "action",
                                "direction"
                              ],
                              "type": "object",
                              "x-kubernetes-validations": [
                                {
                                  "message": "both destination and source cannot be provided",
                                  "rule": "(has(self.destination) && !has(self.source)) || (!has(self.destination) && has(self.source))"
                                },
                                {
                                  "message": "source must be set for VPCSecurityGroupRuleDirectionInbound direction",
                                  "rule": "self.direction == 'inbound' ? has(self.source) : true"
                                },
                                {
                                  "message": "destination is not valid for VPCSecurityGroupRuleDirectionInbound direction",
                                  "rule": "self.direction == 'inbound' ? !has(self.destination) : true"
                                },
                                {
                                  "message": "destination must be set for VPCSecurityGroupRuleDirectionOutbound direction",
                                  "rule": "self.direction == 'outbound' ? has(self.destination) : true"
                                },
                                {
                                  "message": "source is not valid for VPCSecurityGroupRuleDirectionOutbound direction",
                                  "rule": "self.direction == 'outbound' ? !has(self.source) : true"
                                }
                              ]
                            },
                            "type": "array"
                          },
                          "tags": {
                            "items": {
                              "type": "string"
                            },
                            "type": "array"
                          }
                        },
                        "type": "object",
                        "x-kubernetes-validations": [
                          {
                            "message": "either an id or name must be specified",
                            "rule": "has(self.id) || has(self.name)"
                          }
                        ]
                      },
                      "type": "array"
                    },
                    "vpc": {
                      "additionalProperties": false,
                      "properties": {
                        "id": {
                          "minLength": 1,
                          "type": "string"
                        },
                        "name": {
                          "minLength": 1,
                          "type": "string"
                        }
                      },
                      "type": "object",
                      "x-kubernetes-validations": [
                        {
                          "message": "an id or name must be provided",
                          "rule": "has(self.id) || has(self.name)"
                        }
                      ]
                    },
                    "workerSubnets": {
                      "items": {
                        "additionalProperties": false,
                        "properties": {
                          "cidr": {
                            "type": "string"
                          },
                          "id": {
                            "maxLength": 64,
                            "minLength": 1,
                            "pattern": "^[-0-9a-z_]+$",
                            "type": "string"
                          },
                          "name": {
                            "maxLength": 63,
                            "minLength": 1,
                            "pattern": "^([a-z]|[a-z][-a-z0-9]*[a-z0-9])$",
                            "type": "string"
                          },
                          "zone": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                },
                "region": {
                  "type": "string"
                },
                "resourceGroup": {
                  "type": "string"
                },
                "vpc": {
                  "type": "string"
                },
                "zone": {
                  "type": "string"
                }
              },
              "required": [
                "region",
                "resourceGroup"
              ],
              "type": "object"
            }
          },
          "required": [
            "spec"
          ],
          "type": "object"
        }
      },
      "type": "object"
    }
  },
  "type": "object"
}
