{
  "type": "object",
  "properties": {
    "apiVersion": {
      "type": "string"
    },
    "kind": {
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "type": "object",
      "required": [
        "compositeTypeRef"
      ],
      "properties": {
        "compositeTypeRef": {
          "type": "object",
          "required": [
            "apiVersion",
            "kind"
          ],
          "properties": {
            "apiVersion": {
              "type": "string"
            },
            "kind": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "x-kubernetes-validations": [
            {
              "rule": "self == oldSelf",
              "message": "Value is immutable"
            }
          ]
        },
        "mode": {
          "type": "string",
          "default": "Pipeline",
          "enum": [
            "Pipeline"
          ]
        },
        "pipeline": {
          "type": "array",
          "maxItems": 99,
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "functionRef",
              "step"
            ],
            "properties": {
              "credentials": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": [
                    "name",
                    "source"
                  ],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "secretRef": {
                      "type": "object",
                      "required": [
                        "name",
                        "namespace"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "namespace": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": false
                    },
                    "source": {
                      "type": "string",
                      "enum": [
                        "None",
                        "Secret"
                      ]
                    }
                  },
                  "additionalProperties": false,
                  "x-kubernetes-validations": [
                    {
                      "rule": "self.source == 'Secret' \u0026\u0026 has(self.secretRef)",
                      "message": "the Secret source requires a secretRef"
                    }
                  ]
                },
                "x-kubernetes-list-map-keys": [
                  "name"
                ],
                "x-kubernetes-list-type": "map"
              },
              "functionRef": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "input": {
                "type": "object",
                "x-kubernetes-preserve-unknown-fields": true,
                "x-kubernetes-embedded-resource": true
              },
              "requirements": {
                "type": "object",
                "properties": {
                  "requiredResources": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "apiVersion",
                        "kind",
                        "requirementName"
                      ],
                      "properties": {
                        "apiVersion": {
                          "type": "string"
                        },
                        "kind": {
                          "type": "string"
                        },
                        "matchLabels": {
                          "type": "object",
                          "additionalProperties": {
                            "type": "string"
                          }
                        },
                        "name": {
                          "type": "string"
                        },
                        "namespace": {
                          "type": "string"
                        },
                        "requirementName": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": false,
                      "x-kubernetes-validations": [
                        {
                          "rule": "(has(self.name) \u0026\u0026 !has(self.matchLabels)) || (!has(self.name) \u0026\u0026 has(self.matchLabels))",
                          "message": "Either name or matchLabels must be specified, but not both"
                        }
                      ]
                    },
                    "x-kubernetes-list-map-keys": [
                      "requirementName"
                    ],
                    "x-kubernetes-list-type": "map"
                  }
                },
                "additionalProperties": false
              },
              "step": {
                "type": "string"
              }
            },
            "additionalProperties": false
          },
          "x-kubernetes-list-map-keys": [
            "step"
          ],
          "x-kubernetes-list-type": "map"
        },
        "writeConnectionSecretsToNamespace": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "x-kubernetes-validations": [
        {
          "rule": "self.mode == 'Pipeline' \u0026\u0026 has(self.pipeline)",
          "message": "an array of pipeline steps is required in Pipeline mode"
        }
      ]
    }
  }
}
