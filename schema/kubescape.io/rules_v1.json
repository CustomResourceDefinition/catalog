{
  "type": "object",
  "properties": {
    "apiVersion": {
      "type": "string"
    },
    "kind": {
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "type": "object",
      "required": [
        "rules"
      ],
      "properties": {
        "rules": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "enabled",
              "id",
              "name",
              "description",
              "expressions",
              "profileDependency",
              "severity",
              "supportPolicy",
              "isTriggerAlert",
              "mitreTechnique",
              "mitreTactic"
            ],
            "properties": {
              "agentVersionRequirement": {
                "description": "Agent version requirement to evaluate this rule (supports semver ranges like ~1.0, \u003e=1.2.0, etc.)",
                "type": "string"
              },
              "description": {
                "description": "Description of the rule",
                "type": "string"
              },
              "enabled": {
                "description": "Whether the rule is enabled",
                "type": "boolean"
              },
              "expressions": {
                "type": "object",
                "required": [
                  "message",
                  "uniqueId",
                  "ruleExpression"
                ],
                "properties": {
                  "message": {
                    "description": "Message expression",
                    "type": "string"
                  },
                  "ruleExpression": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "eventType",
                        "expression"
                      ],
                      "properties": {
                        "eventType": {
                          "description": "Type of event this expression handles",
                          "type": "string"
                        },
                        "expression": {
                          "description": "The rule expression string",
                          "type": "string"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "uniqueId": {
                    "description": "Unique identifier expression",
                    "type": "string"
                  }
                },
                "additionalProperties": false
              },
              "id": {
                "description": "Unique identifier for the rule",
                "type": "string"
              },
              "isTriggerAlert": {
                "description": "Whether the rule is a trigger alert",
                "type": "boolean",
                "default": true
              },
              "mitreTactic": {
                "description": "MITRE tactic associated with the rule",
                "type": "string"
              },
              "mitreTechnique": {
                "description": "MITRE technique associated with the rule",
                "type": "string"
              },
              "name": {
                "description": "Name of the rule",
                "type": "string"
              },
              "profileDependency": {
                "description": "Profile dependency level (0=Required, 1=Optional, 2=NotRequired)",
                "type": "integer",
                "enum": [
                  0,
                  1,
                  2
                ]
              },
              "severity": {
                "description": "Severity level of the rule",
                "type": "integer"
              },
              "state": {
                "description": "State information for the rule",
                "type": "object",
                "additionalProperties": true
              },
              "supportPolicy": {
                "description": "Whether the rule supports rule policy enforcement",
                "type": "boolean",
                "default": false
              },
              "tags": {
                "description": "Tags associated with the rule",
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    }
  }
}
