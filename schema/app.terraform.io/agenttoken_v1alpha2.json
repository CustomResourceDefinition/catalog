{
  "description": "AgentToken manages HCP Terraform Agent Tokens.\nMore information:\n- https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/api-tokens#agent-api-tokens",
  "type": "object",
  "required": [
    "spec"
  ],
  "properties": {
    "apiVersion": {
      "description": "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources",
      "type": "string"
    },
    "kind": {
      "description": "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds",
      "type": "string"
    },
    "metadata": {
      "type": "object"
    },
    "spec": {
      "description": "AgentTokenSpec defines the desired state of AgentToken.",
      "type": "object",
      "required": [
        "agentPool",
        "agentTokens",
        "organization",
        "secretName",
        "token"
      ],
      "properties": {
        "agentPool": {
          "description": "The Agent Pool name or ID where the tokens will be managed.",
          "type": "object",
          "properties": {
            "id": {
              "description": "Agent Pool ID.\nMust match pattern: `^apool-[a-zA-Z0-9]+$`",
              "type": "string",
              "pattern": "^apool-[a-zA-Z0-9]+$"
            },
            "name": {
              "description": "Agent Pool name.",
              "type": "string",
              "minLength": 1
            }
          },
          "additionalProperties": false
        },
        "agentTokens": {
          "description": "List of the HCP Terraform Agent tokens to manage.",
          "type": "array",
          "minItems": 1,
          "items": {
            "description": "Agent Token is a secret token that a HCP Terraform Agent is used to connect to the HCP Terraform Agent Pool.\nIn `spec` only the field `Name` is allowed, the rest are used in `status`.\nMore infromation:\n  - https://developer.hashicorp.com/terraform/cloud-docs/agents",
            "type": "object",
            "required": [
              "name"
            ],
            "properties": {
              "createdAt": {
                "description": "Timestamp of when the agent token was created.",
                "type": "integer",
                "format": "int64"
              },
              "id": {
                "description": "Agent Token ID.",
                "type": "string",
                "pattern": "^at-[a-zA-Z0-9]+$"
              },
              "lastUsedAt": {
                "description": "Timestamp of when the agent token was last used.",
                "type": "integer",
                "format": "int64"
              },
              "name": {
                "description": "Agent Token name.",
                "type": "string",
                "minLength": 1
              }
            },
            "additionalProperties": false
          }
        },
        "deletionPolicy": {
          "description": "The Deletion Policy defines how managed tokens and Kubernetes Secrets should be handled when the custom resource is deleted.\n- `retain`: When the custom resource is deleted, the operator will remove only the resource itself.\n  The managed HCP Terraform Agent tokens will remain active on the HCP Terraform side, and the corresponding Kubernetes Secret will not be modified.\n- `destroy`: The operator will attempt to delete the managed HCP Terraform Agent tokens and remove the corresponding Kubernetes Secret.\nDefault: `retain`.",
          "type": "string",
          "default": "retain",
          "enum": [
            "retain",
            "destroy"
          ]
        },
        "managementPolicy": {
          "description": "The Management Policy defines how the controller will manage tokens in the specified Agent Pool.\n- `merge`  — the controller will manage its tokens alongside any existing tokens in the pool, without modifying or deleting tokens it does not own.\n- `owner`  — the controller assumes full ownership of all agent tokens in the pool, managing and potentially modifying or deleting all tokens, including those not created by it.\nDefault: `merge`.",
          "type": "string",
          "default": "merge",
          "enum": [
            "merge",
            "owner"
          ]
        },
        "organization": {
          "description": "Organization name where the Workspace will be created.\nMore information:\n  - https://developer.hashicorp.com/terraform/cloud-docs/users-teams-organizations/organizations",
          "type": "string",
          "minLength": 1
        },
        "secretName": {
          "description": "secretName specifies the name of the Kubernetes Secret\nwhere the HCP Terraform Agent tokens are stored.",
          "type": "string",
          "minLength": 1
        },
        "token": {
          "description": "API Token to be used for API calls.",
          "type": "object",
          "required": [
            "secretKeyRef"
          ],
          "properties": {
            "secretKeyRef": {
              "description": "Selects a key of a secret in the workspace's namespace",
              "type": "object",
              "required": [
                "key"
              ],
              "properties": {
                "key": {
                  "description": "The key of the secret to select from.  Must be a valid secret key.",
                  "type": "string"
                },
                "name": {
                  "description": "Name of the referent.\nThis field is effectively required, but due to backwards compatibility is\nallowed to be empty. Instances of this type with an empty value here are\nalmost certainly wrong.\nMore info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names",
                  "type": "string",
                  "default": ""
                },
                "optional": {
                  "description": "Specify whether the Secret or its key must be defined",
                  "type": "boolean"
                }
              },
              "additionalProperties": false,
              "x-kubernetes-map-type": "atomic"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "status": {
      "description": "AgentTokenStatus defines the observed state of AgentToken.",
      "type": "object",
      "required": [
        "observedGeneration"
      ],
      "properties": {
        "agentPool": {
          "description": "Agent Pool where tokens are managed by the controller.",
          "type": "object",
          "properties": {
            "id": {
              "description": "Agent Pool ID.\nMust match pattern: `^apool-[a-zA-Z0-9]+$`",
              "type": "string",
              "pattern": "^apool-[a-zA-Z0-9]+$"
            },
            "name": {
              "description": "Agent Pool name.",
              "type": "string",
              "minLength": 1
            }
          },
          "additionalProperties": false
        },
        "agentTokens": {
          "description": "List of the agent tokens managed by the controller.",
          "type": "array",
          "items": {
            "description": "Agent Token is a secret token that a HCP Terraform Agent is used to connect to the HCP Terraform Agent Pool.\nIn `spec` only the field `Name` is allowed, the rest are used in `status`.\nMore infromation:\n  - https://developer.hashicorp.com/terraform/cloud-docs/agents",
            "type": "object",
            "required": [
              "name"
            ],
            "properties": {
              "createdAt": {
                "description": "Timestamp of when the agent token was created.",
                "type": "integer",
                "format": "int64"
              },
              "id": {
                "description": "Agent Token ID.",
                "type": "string",
                "pattern": "^at-[a-zA-Z0-9]+$"
              },
              "lastUsedAt": {
                "description": "Timestamp of when the agent token was last used.",
                "type": "integer",
                "format": "int64"
              },
              "name": {
                "description": "Agent Token name.",
                "type": "string",
                "minLength": 1
              }
            },
            "additionalProperties": false
          }
        },
        "observedGeneration": {
          "description": "Real world state generation.",
          "type": "integer",
          "format": "int64"
        }
      },
      "additionalProperties": false
    }
  }
}
