volumes:
  nginx-content:
  runner-root-cache:
  runner-go-mod-cache:

services:
  runner:
    image: ${RUNNER}
    volumes:
      - .:/workspace
      - nginx-content:/repository/http
      - runner-root-cache:/root/.cache
      - runner-go-mod-cache:/go/pkg/mod
    working_dir: /workspace
    depends_on:
      registry:
        condition: service_started
      nginx:
        condition: service_started
  registry:
    image: registry:2
  nginx:
    image: nginxinc/nginx-unprivileged:alpine-slim
    volumes:
      - nginx-content:/usr/share/nginx/html:ro
# --- test tools ---
  editorconfig:
    image: mstruebing/editorconfig-checker
    volumes:
      - .:/workspace:ro
    working_dir: /workspace
  hadolint:
    image: hadolint/hadolint
    entrypoint: /bin/hadolint
    volumes:
      - .:/workspace:ro
    working_dir: /workspace
  checkmake:
    image: mrtazz/checkmake
    volumes:
      - ./Makefile:/Makefile:ro
      - ./make.d:/make.d:ro
